
<!doctype html>
<html>
<head>
    <%- include("./comp_head.html")%>
    <link rel="stylesheet" href="/css/comment-images.css">
</head>

<body>

    <%- include("./comp_header.html")%>	
    <%- include("./comp_nav.html")%> 

    <main class="clear">
        <div class="mainLeft">
            
            <% if (article) { %>
            <div class="listBox" id="articleData" data-article-id="<%= article._id %>">
                <h1><%= article.title %></h1>
                <p class="colDefault">
                    作者：<span class="colInfo"><%= article.author ? article.author.username : '未知' %></span> -
                    时间：<span class="colInfo"><%= new Date(article.createTime).toLocaleString('zh-CN', {year: 'numeric', month: 'numeric', day: 'numeric', hour: 'numeric', minute: 'numeric', second: 'numeric'}) %></span> -
                    阅读：<span class="colInfo"><%= article.views || 0 %></span> -
                    评论：<span class="colInfo" id="totalComments">0</span>
                </p>
                <dfn>
                    <%- article.content %>
                </dfn>
                
                <!-- 文章操作按钮 -->
                <div class="article-actions" style="margin-top: 20px; padding: 15px; border-top: 1px solid #eee; text-align: center;">
                    <% if (userInfo) { %>
                    <button id="favoriteBtn" class="btn-favorite" data-article-id="<%= article._id %>" style="background: #007bff; color: white; border: none; padding: 8px 20px; border-radius: 4px; cursor: pointer; margin-right: 10px;">
                        <i class="fa fa-heart-o"></i> <span class="favorite-text">收藏</span>
                    </button>
                    <% } else { %>
                    <button onclick="showLoginModal()" class="btn-favorite" style="background: #6c757d; color: white; border: none; padding: 8px 20px; border-radius: 4px; cursor: pointer; margin-right: 10px;">
                        <i class="fa fa-heart-o"></i> 登录后收藏
                    </button>
                    <% } %>
                    <span class="article-share" style="color: #666;">
                        <i class="fa fa-share-alt"></i> 分享文章
                    </span>
                </div>
            </div>
            <% } else { %>
            <div class="listBox">
                <h1>文章不存在或已被删除</h1>
                <p class="colDefault">
                    该文章不存在或已被删除
                </p>
            </div>
            <% } %>

            <% if (article) { %>
            <div class="listBox message">
                <h3 class="textLeft"><strong>评论</strong> <span class="em">一共有 <em id="messageCount">0</em> 条评论</span></h3>
                
                <% if (userInfo) { %>
                <div id="userData" data-user-id="<%= userInfo._id %>" data-username="<%= userInfo.username %>" data-is-logged-in="true">
                    <p class="textLeft"><%= userInfo.username %></p>
                    <p class="textLeft clear">
                        <textarea id="messageContent" placeholder="请输入您的评论..."></textarea><button id="messageBtn" class="submit">提交</button>
                    </p>
                    
                    <!-- 图片上传区域 -->
                    <div class="comment-image-upload">
                        <div class="image-upload-area" id="imageUploadArea">
                            <div class="upload-prompt">
                                <i class="fa fa-image"></i>
                                <span>点击或拖拽添加图片</span>
                                <small>支持JPG、PNG、GIF格式，单张最大5MB，最多3张</small>
                            </div>
                            <input type="file" id="imageInput" accept="image/*" multiple style="display: none;">
                        </div>
                        <div class="image-preview-container" id="imagePreviewContainer"></div>
                    </div>
                    
                    <div id="commentStatus" style="display: none; margin-top: 10px; padding: 10px; border-radius: 4px;"></div>
                </div>
                <% } else { %>
                <p class="bgDanger" style="line-height: 30px;">你还没有登录，请先<a href="javascript:void(0)" onclick="showLoginModal()">登录</a>！</p>
                <% } %>
                
                <!-- 评论状态显示区域 -->
                <div id="commentStatus" style="display: none; padding: 10px; margin: 10px 0; border: 1px solid; border-radius: 4px;"></div>
                
                <div class="messageList" id="commentContainer">
                    <!-- 评论将通过JavaScript动态加载 -->
                </div>

                <div class="pager" id="commentPager">
                    <ul class="clear">
                        <!-- 分页将通过JavaScript动态加载 -->
                    </ul>
                </div>
            </div>
            <% } %>

            <div class="pager">
                <ul class="clear">
                    <li class="previous">
                        <a href="">上一页</a>
                    </li>
                    <li></li>
                    <li class="next">
                        <a href="">下一页</a>
                    </li>
                </ul>
            </div>

        </div>

        <%- include("./comp_sidebar.html")%>

    </main>
    +
    <%- include("./comp_footer.html")%>
    <script src="/js/comment-images.js"></script>
</body>
</html>